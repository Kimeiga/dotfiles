#!/bin/bash

# Filter JSON files from git diff and copy to clipboard
# Usage: ./filter_json_diff.sh [base_branch]

BASE_BRANCH=${1:-master}

# Run git diff and process in a single stream
git diff "$BASE_BRANCH" | awk '
BEGIN { 
  skip = 0; 
  json_pattern = "\\.json($|[[:space:]])";
}
/^diff --git/ { 
  if ($0 ~ json_pattern) {
    skip = 1;
  } else {
    skip = 0;
    print;
  }
  next;
}
{ if (skip == 0) print; }
' | pbcopy

echo "Filtered diff copied to clipboard (JSON files removed)"